!function(a){"function"==typeof define&&define.amd?define(["jquery","knockout"],a):a($,ko)}(function($,ko){"use strict";function _updateDom(a,b){for(var c in b){var d=b[c];for(var e in d){var f=d[e];if("trigger"==e)a.trigger(f[0]);else if($.isArray(f))$.each(f,function(b,c){a[b](c)});else try{a[c](d)}catch(g){a[c](d[c])}}}}var IWEB_VERSION="1.0.0",IWEB_THEME="i_theme",IWEB_LOCALE="i_locale",IWEB_USERCODE="usercode",LOG_Level="ill",systemTimeZoneOffset=-480,IWEB_CONTEXT_PATH="contextpath",iweb={version:IWEB_VERSION};window.getCookie||(window.getCookie=function(a){var b="(?:; )?"+a+"=([^;]*);?",c=new RegExp(b);return c.test(document.cookie)?decodeURIComponent(RegExp.$1):null}),window.createShellObject=function(a){var b=function(){};return b.prototype=a,new b},function(){var a={},b={},c={},d={"float":{precision:2},datetime:{format:"yyyy-MM-dd hh:mm:ss",metaType:"DateTimeFormatMeta",speratorSymbol:"-"},time:{format:"hh:mm:ss"},date:{format:"yyyy-MM-dd"},currency:{precision:2,curSymbol:"￥"}},e={};e.getEnvironment=function(){return createShellObject(a)},e.getClientAttributes=function(){return createShellObject(b)},e.setContextPath=function(b){return a[IWEB_CONTEXT_PATH]=b},e.getContextPath=function(){return a[IWEB_CONTEXT_PATH]},e.setClientAttribute=function(a,c){b[a]=c},e.getSessionAttributes=function(){return createShellObject(c)},e.setSessionAttribute=function(a,b){c[a]=b,setCookie("ISES_"+a,b)},e.removeClientAttribute=function(a){b[a]=null,execIgnoreError(function(){delete b[a]})},e.getRootComponent=function(){return this.rootComponet},e.setRootComponent=function(a){this.rootComponet=a},e.getTheme=function(){return this.getEnvironment().theme},e.getLocale=function(){return this.getEnvironment().locale},e.collectEnvironment=function(){var a=this.getEnvironment(),c=this.getSessionAttributes();for(var d in b)c[d]=b[d];return a.clientAttributes=c,a},e.changeTheme=function(b){a.theme=b,setCookie(IWEB_THEME,b),$(document).trigger("themeChange")},e.changeLocale=function(a){econsoleconsolenvironment.locale=a,setCookie(IWEB_LOCALE,a),$(document).trigger("localeChange")},e.setMaskerMeta=function(a,b){if(d[a])if("object"!=typeof b)d[a]=b;else for(var c in b)d[a][c]=b[c];else d[a]=b},e.getMaskerMeta=function(a){return d[a]},e.registerSystemTimeZoneOffset=function(a){systemTimeZoneOffset=a},e.getSystemTimeZoneOffset=function(){return systemTimeZoneOffset};var f={Android:function(){return/Android/i.test(navigator.userAgent)},BlackBerry:function(){return/BlackBerry/i.test(navigator.userAgent)},iOS:function(){return/iPhone|iPad|iPod/i.test(navigator.userAgent)},Windows:function(){return/IEMobile/i.test(navigator.userAgent)},any:function(){return this.Android()||this.BlackBerry()||this.iOS()||this.Windows()},pc:function(){return!this.any()},Screen:{size:noop,direction:noop}};e.getDevice=function(){return f},a.theme=getCookie(IWEB_THEME),a.locale=getCookie(IWEB_LOCALE),a.timezoneOffset=(new Date).getTimezoneOffset(),a.usercode=getCookie(IWEB_USERCODE),document.cookie.replace(/ISES_(\w*)=([^;]*);?/gi,function(a,b,d){c[b]=d});var g=function(){};g.prototype=e,iweb.Core=new g}(),function(){var a,b=getCookie(IWEB_USERCODE);if("undefined"!=typeof Log4js){a=new Log4js.Logger("iweb"),a.setLevel(Log4js.Level.ERROR);var c=new Log4js.ConsoleAppender(a,!0);a.addAppender(c)}else a={LEVEL_MAP:{OFF:Number.MAX_VALUE,ERROR:4e4,WARN:3e4,INFO:2e4,DEBUG:1e4,TRACE:5e3,ALL:1},level:4e4,setLevel:function(a){if(a){var b=this.LEVEL_MAP[a.toUpperCase()];b&&(this.level=b)}},isDebugEnabled:function(){return this.LEVEL_MAP.DEBUG>=this.level&&console},isTraceEnabled:function(){return this.LEVEL_MAP.TRACE>=this.level&&console},isInfoEnabled:function(){return this.LEVEL_MAP.INFO>=this.level&&console},isWarnEnabled:function(){return this.LEVEL_MAP.WARN>=this.level&&console},isErrorEnabled:function(){return this.LEVEL_MAP.ERROR>=this.level&&console},debug:function(){this.isDebugEnabled()&&console.debug.call(console,arguments)},warn:function(){this.isWarnEnabled()&&console.debug.call(console,arguments)},info:function(){this.isInfoEnabled()&&console.debug.call(console,arguments)},trace:function(){this.isTraceEnabled()&&console.debug.call(console,arguments)},error:function(){this.isErrorEnabled()&&console.debug.call(console,arguments)}};a.setLevel(b),iweb.log=a,iweb.debugMode=!1}(),window.iweb=iweb;var noop=function(){},App=function(){this.dataTables={}};App.fn=App.prototype,App.fn.init=function(a,b){var c=this;this.element=b||document.body,$(this.element).find("[u-meta]").each(function(){if(!($(this).data("u-meta")||$(this).parents("[u-meta]").length>0)){var b=JSON.parse($(this).attr("u-meta"));if(b&&b.type){c.adjustFunc&&c.adjustFunc.call(c,b);var d=$.compManager._createComp(this,b,a,c);d&&$(this).data("u-meta",d)}}}),_getDataTables(this,a);try{ko.applyBindings(a,this.element)}catch(d){iweb.log.error(d)}},App.fn.setAdjustMetaFunc=function(a){this.adjustFunc=a},App.fn.addDataTable=function(a){return this.dataTables[a.id]=a,this},App.fn.getDataTable=function(a){return this.dataTables[a]},App.fn.getDataTables=function(){return this.dataTables},App.fn.getComp=function(a){var b=null;return $(this.element).find("[u-meta]").each(function(){if($(this).data("u-meta")){var c=$(this).data("u-meta");if(c.id==a)return b=c,!1}}),b},App.fn.getComps=function(a){a=a?a:this.element;var b=[];return $(a).find("[u-meta]").each(function(){if($(this).data("u-meta")){var a=$(this).data("u-meta");a&&b.push(a)}}),b},App.fn.getCompsByType=function(a,b){b=b?b:this.element;var c=[];return $(b).find("[u-meta]").each(function(){if($(this).data("u-meta")){var b=$(this).data("u-meta");b&&b.type==a&&c.push(b)}}),c},App.fn.getEnvironment=function(){return window.iweb.Core.collectEnvironment()},App.fn.setClientAttribute=function(a,b){window.iweb.Core.setClientAttribute(a,b)},App.fn.getClientAttribute=function(a){window.iweb.Core.getClientAttributes()[a]},App.fn.serverEvent=function(){return new ServerEvent(this)},App.fn.ajax=function(a){a=this._wrapAjax(a),$.ajax(a)},App.fn._wrapAjax=function(a){var b=this,c=a.success,d=a.error,e=a.deferred;return e&&e.resolve||(e={resolve:function(){},reject:function(){}}),a.success=function(a,d,f){processXHRError(b,a,d,f)?(c.call(null,a),b._successFunc(a,e)):e.reject()},a.error=function(a,c,f){processXHRError(b,a,c,f)?(d.call(null,a),b._successFunc(a,e)):e.reject()},a.data?a.data.environment=ko.toJSON(window.iweb.Core.collectEnvironment()):a.data={environment:ko.toJSON(window.iweb.Core.collectEnvironment())},a},App.fn._successFunc=function(a,b){b.resolve()},App.fn.setUserCache=function(a,b){var c=this.getEnvironment().usercode;c&&localStorage.setItem(c+a,b)},App.fn.getUserCache=function(a){var b=this.getEnvironment().usercode;if(b)return localStorage.getItem(b+a)},App.fn.removeUserCache=function(a){var b=this.getEnvironment().usercode;b&&localStorage.removeItem(b+a)},App.fn.setCache=function(a,b){localStorage.setItem(a,b)},App.fn.getCache=function(a){return localStorage.getItem(a)},App.fn.removeCache=function(a){localStorage.removeItem(a)},App.fn.setSessionCache=function(a,b){sessionStorage.setItem(a,b)},App.fn.getSessionCache=function(a){return sessionStorage.getItem(a)},App.fn.removeSessionCache=function(a){sessionStorage.removeItem(a)},App.fn.setEnable=function(a){$(this.element).find("[u-meta]").each(function(){if($(this).data("u-meta")){var b=$(this).data("u-meta");b.setEnable&&b.setEnable(a)}})};var ServerEvent=function(a){this.app=a,this.datas={},this.params={},this.event=null,this.ent=window.iweb.Core.collectEnvironment(),window.pako&&0==iweb.debugMode&&(this.compression=!0)};ServerEvent.DEFAULT={async:!0,singleton:!0,url:(iweb.Core.getContextPath()||"/iwebap")+"/evt/dispatch"},ServerEvent.fn=ServerEvent.prototype,ServerEvent.fn.addDataTable=function(a,b){var c=this.app.getDataTable(a);return this.datas[a]=c.getDataByRule(b),this},ServerEvent.fn.setCompression=function(a){window.pako||1!=a?this.compression=a:iweb.log.error("can't compression, please include  pako!")},ServerEvent.fn.addDataTables=function(a){for(var b=0;b<a.length;b++){var c=a[b];if("string"==typeof c)this.addDataTable(c);else for(key in c)this.addDataTable(key,c[key])}return this},ServerEvent.fn.addAllDataTables=function(a){for(var b=this.app.dataTables,c=0;c<b.length;c++)this.addDataTable(b[c].id,a)},ServerEvent.fn.addParameter=function(a,b){return this.params[a]=b,this},ServerEvent.fn.setEvent=function(a){return this.event=a,this};var _formatEvent=function(a){return a};ServerEvent.fn.fire=function(a){var b=this,c=this.getData();c.parameters=ko.toJSON(this.params);var d={type:"POST",data:a.params||{},url:a.url||ServerEvent.DEFAULT.url,async:a.async||ServerEvent.DEFAULT.async,singleton:a.singleton||ServerEvent.DEFAULT.singleton,success:a.success,error:a.error};d.data.ctrl=a.ctrl,d.data.method=a.method,this.event&&(d.data.event=ko.toJSON(this.event));var e=d.preSuccess||function(){},f=d.success||function(){},g=d.error||function(){};this.orignError=g;var h=d.deferred;h&&h.resolve||(h={resolve:function(){},reject:function(){}}),d.success=function(a,c,d){processXHRError(b,a,c,d)?(e.call(null,a),b._successFunc(a,h),f.call(null,a.custom),h.resolve()):h.reject()},d.error=function(a,c,d){processXHRError(b,a,c,d)?g.call(null,a.custom):h.reject()},d.data=$.extend(d.data,c),$.ajax(d)},ServerEvent.fn.getData=function(){var a=ko.toJSON(this.app.getEnvironment()),b=ko.toJSON(this.datas);return this.compression&&(a=encodeBase64(window.pako.gzip(a)),b=encodeBase64(window.pako.gzip(b))),{environment:a,dataTables:b,compression:this.compression}},ServerEvent.fn._successFunc=function(a,b){var c=a.dataTables,d=a.dom;d&&this.updateDom(JSON.parse(d)),c&&this.updateDataTables(c,b)},ServerEvent.fn.updateDataTables=function(a){for(var b in a){var c=this.app.getDataTable(b);c&&c.setData(a[b])}},ServerEvent.fn.setSuccessFunc=function(a){this._successFunc=a},ServerEvent.fn.updateDom=function(){$.each(dom,function(a,b){var c=b.two,d=$(b.one);_updateDom(d,c)})};var processXHRError=function(self,rsl,state,xhr){if("string"==typeof rsl&&(rsl=JSON.parse(rsl)),xhr.getResponseHeader&&xhr.getResponseHeader("X-Error")){if(!self.orignError)return $.showMessageDialog({type:"info",title:"提示",msg:rsl.message,backdrop:!0}),rsl.operate&&eval(rsl.operate),!1;self.orignError.call(self,rsl,state,xhr)}return!0};$.createApp=function(){var a=new App;return a};var _getDataTables=function(a,b){for(var c in b)b[c]instanceof $.DataTable&&(b[c].id=c,a.addDataTable(b[c]))},Events=function(){};Events.fn=Events.prototype,Events.fn.on=function(a,b){a=a.toLowerCase(),this._events||(this._events={});var c=this._events[a]||(this._events[a]=[]);return c.push({callback:b}),this},Events.fn.trigger=function(a){if(a=a.toLowerCase(),!this._events||!this._events[a])return this;for(var b=Array.prototype.slice.call(arguments,1),c=this._events[a],d=0,e=c.length;e>d;d++)c[d].callback.apply(this,b);return this},Events.fn.getEvent=function(a){return a=a.toLowerCase(),this._events||(this._events={}),this._events[a]};var DataTable=function(a){this.id=a.id,this.meta=a.meta,this.enable=a.enable||DataTable.DEFAULTS.enable,this.pageSize=ko.observable(a.pageSize||DataTable.DEFAULTS.pageSize),this.pageIndex=ko.observable(a.pageIndex||DataTable.DEFAULTS.pageIndex),this.totalPages=ko.observable(a.totalPages||DataTable.DEFAULTS.totalPages),this.pageCache=DataTable.DEFAULTS.pageCache,this.rows=ko.observableArray([]),this.selectedIndices=[],this.currSelectedIndex=-1,this.cachedPages=[],this.createDefaultEvents(),this.metaChange=ko.observable(1),this.valueChange=ko.observable(1),this.enableChange=ko.observable(1),this.params=a.params||{}};DataTable.fn=DataTable.prototype=new Events,DataTable.DEFAULTS={pageSize:20,pageIndex:0,totalPages:20,pageCache:!1,enable:!0},DataTable.ON_ROW_SELECT="select",DataTable.ON_ROW_UNSELECT="unSelect",DataTable.ON_ROW_ALLSELECT="allSelect",DataTable.ON_ROW_ALLUNSELECT="allUnselect",DataTable.ON_VALUE_CHANGE="valueChange",DataTable.ON_INSERT="insert",DataTable.ON_UPDATE="update",DataTable.ON_DELETE="delete",DataTable.ON_DELETE_ALL="deleteAll",DataTable.ON_LOAD="load",DataTable.SUBMIT={current:"current",all:"all",select:"select",change:"change"},DataTable.fn.createDefaultEvents=function(){},DataTable.fn.addParam=function(a,b){this.params[a]=b},DataTable.fn.addParams=function(a){for(var b in a)this.params[b]=a[b]},DataTable.fn.getParam=function(a){return this.params[a]},DataTable.fn.getMeta=function(a,b){return 0==arguments.length?this.meta:this.meta[a][b]},DataTable.fn.setMeta=function(a,b,c){this.meta[a][b]=c,this.metaChange(-this.metaChange())},DataTable.fn.setCurrentPage=function(a){this.pageIndex(a);var b=this.cachedPages[this.pageIndex()];b&&(this.removeAllRows(),this.setRows(b.rows),this.setRowsSelect(b.selectedIndcies))},DataTable.fn.isChanged=function(){for(var a=this.getAllRows(),b=0;b<a.length;b++)if(a[b].status!=Row.STATUS.NORMAL)return!0;return!1},DataTable.fn.setData=function(a){{var b=a.pageIndex,c=a.pageSize||this.pageSize(),d=a.totalPages||this.totalPages();a.type}this.setRows(a.rows),this.pageIndex(b),this.pageSize(c),this.totalPages(d),this.updateSelectedIndices(),a.select&&a.select.length>0&&this.setRowsSelect(a.select)},DataTable.fn.setRows=function(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.id||(c.id=Row.getRandomRowId()),c.status==Row.STATUS.DELETE)this.removeRowByRowId(c.id);else{var d=this.getRowByRowId(c.id);d?(d.updateRow(c),$.isEmptyObject(c.data)||this.trigger(DataTable.ON_UPDATE,{index:b,rows:[d]})):(d=new Row({parent:this,id:c.id}),d.setData(a[b]),this.addRow(d))}}},DataTable.fn.cacheCurrentPage=function(){this.pageCache&&(this.cachedPages[this.pageIndex()]={rows:this.rows().slice(),selectedIndcies:this.selectedIndices.slice(),pageSize:this.pageSize()})},DataTable.fn.hasPage=function(a){return this.pageCache&&this.cachedPages[a]&&this.cachedPages[a].pageSize==this.pageSize()?!0:!1},DataTable.fn.copyRow=function(a,b){var c=new Row({parent:this});b&&c.setData(b.getData()),this.insertRows(void 0===a?this.rows().length:a,[c])},DataTable.fn.addRow=function(a){this.insertRow(this.rows().length,a)},DataTable.fn.insertRow=function(a,b){b||(b=new Row({parent:this})),this.insertRows(a,[b])},DataTable.fn.insertRows=function(a,b){for(var c=0;c<b.length;c++)this.rows.splice(a+c,0,b[c]),this.updateSelectedIndices(a+c,"+");this.trigger(DataTable.ON_INSERT,{index:a,rows:b})},DataTable.fn.createEmptyRow=function(){var a=new Row({parent:this});return this.addRow(a),a},DataTable.fn.removeRowByRowId=function(a){var b=this.getIndexByRowId(a);-1!=b&&this.removeRow(b)},DataTable.fn.removeRow=function(a){a instanceof Row&&(a=this.getIndexByRowId(a.rowId)),this.removeRows([a])},DataTable.fn.removeAllRows=function(){this.rows([]),this.selectedIndices=[],this.trigger(DataTable.ON_DELETE_ALL)},DataTable.fn.removeRows=function(a){a=this._formatToIndicesArray(a),a=a.sort();for(var b=[],c=a.length-1;c>=0;c--){var d=a[c],e=this.rows()[d];null!=e&&(b.push(e.rowId),this.rows.splice(d,1),this.updateSelectedIndices(d,"-"))}this.trigger(DataTable.ON_DELETE,{indices:a,rowIds:b})},DataTable.fn.setAllRowsSelect=function(){var a=this.getAllRows(),b=[];for(var c in a)b.push(this.getIndexByRowId(rpws[c].rowId));this.setRowsSelect(b)},DataTable.fn.setRowSelect=function(a){a instanceof Row&&(a=this.getIndexByRowId(a.rowId)),this.setRowsSelect([a])},DataTable.fn.setRowsSelect=function(a){a=this._formatToIndicesArray(a),this.setAllRowsUnSelect(),this.selectedIndices=a;var b=this.getSelectedIndex();this.setCurrentRow(b);var c=this.getRowIdsByIndices(a);this.trigger(DataTable.ON_ROW_SELECT,{indices:a,rowIds:c})},DataTable.fn.addRowsSelect=function(a){a=this._formatToIndicesArray(a);for(var b=0;b<a.length;b++){for(var c=a[b],d=!0,e=0;e<this.selectedIndices.length;e++)this.selectedIndices[e]==c&&(d=!1);d&&this.selectedIndices.push(a[b])}var f=this.getSelectedIndex();this.setCurrentRow(f);var g=this.getRowIdsByIndices(a);this.trigger(DataTable.ON_ROW_SELECT,{indices:a,rowIds:g})},DataTable.fn.getRowIdsByIndices=function(a){for(var b=[],c=0;c<a.length;c++)b.push(this.getRow(a[c]).rowId);return b},DataTable.fn.setAllRowsUnSelect=function(){this.selectedIndices=[],this.trigger(DataTable.ON_ROW_ALLUNSELECT)},DataTable.fn.setRowUnSelect=function(a){this.setRowsUnSelect([a])},DataTable.fn.setRowsUnSelect=function(a){a=this._formatToIndicesArray(a);for(var b=0;b<a.length;b++){var c=a[b],d=this.selectedIndices.indexOf(c);-1!=d&&this.selectedIndices.splice(d,1)}var e=this.getRowIdsByIndices(a);this.trigger(DataTable.ON_ROW_UNSELECT,{indices:a,rowIds:e})},DataTable.fn.updateSelectedIndices=function(a,b){if(null!=this.selectedIndices&&0!=this.selectedIndices.length){for(var c=0,d=this.selectedIndices.length;d>c;c++)"+"==b?this.selectedIndices[c]>=a&&(this.selectedIndices[c]=parseInt(this.selectedIndices[c])+1):"-"==b&&(this.selectedIndices[c]==a?this.selectedIndices.splice(c,1):this.selectedIndices[c]>a&&(this.selectedIndices[c]=this.selectedIndices[c]-1));var e=this.getSelectedIndex();this.setCurrentRow(e)}},DataTable.fn.getSelectedIndex=function(){return null==this.selectedIndices||0==this.selectedIndices.length?-1:this.selectedIndices[0]},DataTable.fn.getSelectedIndexs=function(){return null==this.selectedIndices||0==this.selectedIndices.length?[]:this.selectedIndices},DataTable.fn.getIndexByRowId=function(a){for(var b=0,c=this.rows().length;c>b;b++)if(this.rows()[b].rowId==a)return b;return-1},DataTable.fn.getAllDatas=function(){for(var a=this.getAllRows(),b=[],c=0,d=a.length;d>c;c++)a[c]&&b.push(a[c].getData());return b},DataTable.fn.getData=function(){for(var a=[],b=0;b<this.rows().length;b++)a.push(this.rows()[b].getData());return a},DataTable.fn.getDataByRule=function(a){var b={},c=null;if(b.meta=this.meta,b.params=this.params,a=a||DataTable.SUBMIT.current,a==DataTable.SUBMIT.current){c=[];for(var d=0,e=this.rows().length;e>d;d++)c.push(d==this.currSelectedIndex?this.rows()[d].getData():this.rows()[d].getEmptyData())}else a==DataTable.SUBMIT.all?c=this.getData():a==DataTable.SUBMIT.select?c=this.getSelectedDatas(!0):a==DataTable.SUBMIT.change&&(c=this.getChangedDatas());return b.rows=c,b.select=this.getSelectedIndexs(),b.current=this.getSelectedIndex(),b.pageSize=this.pageSize(),b.pageIndex=this.pageIndex(),b.isChanged=this.isChanged(),b},DataTable.fn.getSelectedDatas=function(a){for(var b=[],c=[],d=0,e=this.selectedIndices.length;e>d;d++)c.push(this.selectedIndices[d]);for(var d=0,e=this.rows().length;e>d;d++)-1!=c.indexOf(d)?b.push(this.rows()[d].getData()):1==a&&b.push(this.rows()[d].getEmptyData());return b},DataTable.fn.ref=function(a){return ko.pureComputed({read:function(){this.valueChange();var b=this.getCurrentRow();return b?b.getValue(a):""},write:function(b){var c=this.getCurrentRow();c&&c.setValue(a,b)},owner:this})},DataTable.fn.refMeta=function(a,b){return ko.pureComputed({read:function(){return this.metaChange(),this.getMeta(a,b)},write:function(c){this.setMeta(a,b,c)},owner:this})},DataTable.fn.refEnable=function(a){return ko.pureComputed({read:function(){return this.enableChange(),this.enable&&(this.getMeta(a,"enable")||!1)},owner:this})},DataTable.fn.isEnable=function(a){return this.enable||this.getMeta(a,"enable")||!1},DataTable.fn.refRowMeta=function(a,b){return ko.pureComputed({read:function(){this.metaChange();var c=this.getCurrentRow();return c?c.getMeta(a,b):""},write:function(b){var c=this.getCurrentRow();c&&c.setMeta(a,b)},owner:this})},DataTable.fn.getValue=function(a,b){return b=b||this.getCurrentRow(),b?b.getValue(a):""},DataTable.fn.setValue=function(a,b,c){c=c?c:this.getCurrentRow(),c&&c.setValue(a,b)},DataTable.fn.setEnable=function(a){this.enable!=a&&(this.enable=a,this.enableChange(-this.enableChange()))},DataTable.fn.getCurrentRow=function(){return-1==this.currSelectedIndex?null:this.rows()[this.currSelectedIndex]},DataTable.fn.setCurrentRow=function(a){a instanceof Row&&(a=this.getIndexByRowId(a.rowId)),this.currSelectedIndex=a,this.valueChange(-this.valueChange())},DataTable.fn.getRow=function(a){return this.rows()[a]},DataTable.fn.getAllRows=function(){return this.rows()},DataTable.fn.getRowByRowId=function(a){for(var b=0,c=this.rows().length;c>b;b++)if(this.rows()[b].rowId==a)return this.rows()[b];return null},DataTable.fn.getChangedDatas=function(a){for(var b=[],c=0,d=this.rows().length;d>c;c++)this.rows()[c]&&this.rows()[c].status!=Row.STATUS.NORMAL?b.push(this.rows()[c].getData()):1==a&&b.push(this.rows()[c].getEmptyData());return b},DataTable.fn._formatToIndicesArray=function(a){if("string"==typeof a||"number"==typeof a)a=[a];else if(a instanceof Row)a=this.getIndexByRowId(a.rowId);else if("array"===$.type(a)&&a.length>0&&a[0]instanceof Row)for(var b=0;b<a.length;b++)a[b]=this.getIndexByRowId(a[b].rowId);return a};var Row=function(a){this.rowId=a.id||Row.getRandomRowId(),this.status=Row.STATUS.NEW,this.parent=a.parent,this.initValue=null,this.data={},this.metaChange=ko.observable(1),this.valueChange=ko.observable(1),this.init()};Row.STATUS={NORMAL:"nrm",UPDATE:"upd",NEW:"new",DELETE:"del"},Row.fn=Row.prototype=new Events,Row.fn.init=function(){var a=this.parent.meta;for(var b in a)if(this.data[b]={},a[b]["default"]){var c=a[b]["default"];for(var d in c)"value"==d?this.data[b].value=c[d]:(this.data[b].meta=this.data[b].meta||{},this.data[b].meta[d]=c[d])}},Row.fn.ref=function(a){return ko.pureComputed({read:function(){return this.valueChange(),this.data[a].value},write:function(b){this.setValue(a,b)},owner:this})},Row.fn.refMeta=function(a,b){return ko.pureComputed({read:function(){this.metaChange(),this.getMeta(a,b)},write:function(c){this.setMeta(a,b,c)},owner:this})},Row.fn.getValue=function(a){return this.data[a].value},Row.fn.setValue=function(a,b){var c=this.getValue(a);c!=b&&(this.data[a].value=b,this.data[a].changed=!0,this.status!=Row.STATUS.NEW&&(this.status=Row.STATUS.UPDATE),this.valueChange(-this.valueChange()),this.parent.getCurrentRow()==this&&this.parent.valueChange(-this.valueChange()),this.parent.trigger(DataTable.ON_VALUE_CHANGE,{eventType:"dataTableEvent",dataTable:this.parent.id,rowId:this.rowId,field:a,oldValue:c,newValue:b}),this.parent.trigger(a+"."+DataTable.ON_VALUE_CHANGE,{eventType:"dataTableEvent",dataTable:this.parent.id,rowId:this.rowId,field:a,oldValue:c,newValue:b}))},Row.fn.getMeta=function(a,b){if(0==arguments.length){var c={};for(var d in this.data)c[d]=this.data[d].meta?this.data[d].meta:{};return c}var e=this.data[a].meta;return e&&e[b]?e[b]:this.parent.getMeta(a,b)},Row.fn.setMeta=function(a,b,c){var d=this.data[a].meta;d||(d=this.data[a].meta={}),d[b]=c,this.metaChange(-this.metaChange()),"enable"==b&&this.enableChange(-this.enableChange())},Row.fn.setData=function(a){this.status=a.status;for(var b in a.data)if(this.data[b]){var c=a.data[b];if("string"==typeof c||"number"==typeof c||null===c)this.data[b].value=this.formatValue(b,c);else if(c.error)$.showMessageDialog({title:"警告",msg:c.error,backdrop:!0});else{this.data[b].value=this.formatValue(b,c.value);for(var d in c.meta)this.setMeta(b,d,c.meta[d])}}},Row.fn.formatValue=function(a,b){var c=this.parent.getMeta(a,"type");return c&&("date"==c||"datetime"==c)?_formatDate(b):b},Row.fn.updateRow=function(a){this.setData(a)},Row.fn.getData=function(){var a=ko.toJS(this.data),b=this.parent.getMeta();for(var c in b)b[c]&&b[c].type&&("date"==b[c].type||"datetime"==b[c].type)&&(a[c].value=_dateToUTCString(a[c].value));return{id:this.rowId,status:this.status,data:a}},Row.fn.getEmptyData=function(){return{id:this.rowId,status:this.status,data:{}}},Row.getRandomRowId=function(){return setTimeout(1)};var _formatDate=function(a){var b=new Date;b.setTime(a);var c=b.getFullYear(),d=b.getMonth()+1;parseInt(d)<10&&(d="0"+d);var e=b.getDate();parseInt(e)<10&&(e="0"+e);var f=b.getHours();parseInt(f)<10&&(f="0"+f);var g=b.getMinutes();parseInt(g)<10&&(g="0"+g);var h=b.getSeconds();parseInt(h)<10&&(h="0"+h);var i=c+"-"+d+"-"+e+" "+f+":"+g+":"+h;return i},_dateToUTCString=function(a){a.indexOf("-")>-1&&(a=a.replace(/\-/g,"/"));var b=Date.parse(a);return isNaN(b)?"":b};$.Row=Row,$.DataTable=DataTable;var CompManager={plugs:{},apply:function(a,b){b=b||document.body,$(b).find("[u-meta]").each(function(){if(!($(this).data("u-meta")||$(this).parent("[u-meta]").length>0)){var b=JSON.parse($(this).attr("u-meta"));if(b&&b.type){var c=CompManager._createComp(this,b,a,app);c&&$(this).data("u-meta",c)}}}),ko.applyBindings(a,b)},addPlug:function(a){var b=a.getName();if(this.plugs||(this.plugs={}),this.plugs[b])throw new Error("plug has exist:"+b);this.plugs[b]=a},_createComp:function(a,b,c){var d=b.type,e=this.plugs[d];return e?new e(a,b,c):null}},_getJSObject=function(a,b){for(var c=b.split("."),d=a,e=0;e<c.length;e++)d=d[c[e]];return d};$.compManager=CompManager});
//# sourceMappingURL=u.min.map